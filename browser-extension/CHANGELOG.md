# 更新日志

## v1.1.1 - 2025-11-16

### ✨ 新功能

- **服务器状态检测**
  - 点击导出前自动检测 `kelivo_import_server.exe` 是否运行
  - 如果服务器未运行，显示友好的提示对话框
  - 提供清晰的操作步骤指导用户启动服务器
  - 避免用户等待后才发现服务器未启动的问题

### 🐛 问题修复

- **修复服务器检测无法访问 localhost 的问题** ⭐ 重要修复
  - 添加 `http://localhost:*/*` 和 `http://127.0.0.1:*/*` 到 host_permissions
  - 修复扩展无法访问本地服务器导致检测失败的问题
  - 现在可以正确检测服务器状态

- **修复助手名称无法修改的问题**
  - 移除了自动迁移逻辑，不再强制将"意图"改为"默认助手"
  - 用户现在可以自由修改助手名称为任意值

- **修复默认值不一致的问题**
  - 统一 `popup.js` 和 `background.js` 中的默认助手名称为"默认助手"
  - 确保首次安装和运行时的默认值一致

### 🔧 技术改进

- 简化 `loadConfig()` 函数，移除不必要的自动迁移代码
- 统一所有文件中的默认配置值
- 新增 `checkServerStatus()` 函数用于服务器健康检查
- 新增 `showServerNotRunningDialog()` 对话框组件
- 智能服务器检测：优先使用 `/health` 端点，如果不存在则使用 `/import` OPTIONS 请求
- 优化超时时间：2秒快速检测，提升用户体验

### 📝 注意事项

**兼容性**：此版本兼容新旧服务器
- ✅ 如果服务器支持 `/health` 端点，使用健康检查（推荐）
- ✅ 如果服务器不支持 `/health` 端点，使用 OPTIONS 请求检测
- ✅ 无需立即更新服务器，扩展可以正常工作

**建议**：为了更好的性能，建议服务器添加 `/health` 端点，参考 `服务器健康检查端点说明.md`。

## v1.1.0 - 2025-11-16

### ✨ 新功能

- **完整对话导出**：自动滚动页面确保长对话完整导出
  - 自动检测页面滚动高度
  - 分段滚动触发 ChatGPT 的懒加载机制
  - 确保所有历史消息都被加载到 DOM 中

- **进度显示**：实时显示导出进度
  - 显示滚动加载进度："正在加载消息... (3/10)"
  - 显示消息提取进度："已提取 50/100 条消息..."
  - 显示导出阶段："生成 Markdown..."、"发送到 Kelivo..."

### 🐛 问题修复

- 修复长对话导出时消息遗漏的问题
- 修复 ChatGPT 懒加载导致的内容不完整问题

### 🔧 技术改进

- `extractConversation()` 改为异步函数，支持进度回调
- 新增 `ensureAllMessagesLoaded()` 函数自动加载所有消息
- 新增 `scrollToLoadAllMessages()` 和 `scrollToLoadAllMessagesFromBottom()` 辅助函数
- 改进 `showLoading()` 函数支持自定义消息

### 📝 使用说明

对于超长对话（100+ 条消息）：
1. 点击"导出到 Kelivo"按钮
2. 等待自动滚动和加载过程（可能需要 10-30 秒）
3. 观察按钮上的进度提示
4. 等待导出完成

## v1.0.0 - 初始版本

### ✨ 功能

- 一键导出 ChatGPT 对话
- 自动导入到 Kelivo 助手
- 智能提取对话标题
- 实时反馈通知

